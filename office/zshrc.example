# Office-specific zsh customizations.
# Copy to ~/.zsh/office/zshrc (and set ZSH_PROFILE=office) to enable.

if [[ -z $IS_MAC ]]; then
   if command -v keychain >/dev/null 2>&1 ; then
      eval `keychain ~/.ssh/id_rsa`
   fi
elif [[ -n $IS_MAC ]]; then
   eval `keychain ~/.ssh/id_ed25519`
fi

if [[ -e ~/perl5/perlbrew/etc/bashrc ]]; then
  source ~/perl5/perlbrew/etc/bashrc
fi

if [[ -e /usr/libexec/java_home ]]; then
  export JAVA_HOME=$(/usr/libexec/java_home)
fi

if command -v brew >/dev/null 2>&1 && [[ -e $(brew --prefix nvm) ]]; then
  if [[ ! -e ~/.nvm ]]; then
    mkdir -p ~/.nvm
  fi
  export NVM_DIR=~/.nvm
  source $(brew --prefix nvm)/nvm.sh
fi

unalias run-help
autoload run-help
HELPDIR=/usr/local/share/zsh/help

test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

autoload -U promptinit; promptinit
# prompt spaceship

export SPACESHIP_TIME_SHOW=true

if [[ -e /opt/puppetlabs/pdk ]]; then
    export PATH=$PATH:/opt/puppetlabs/pdk/bin
fi

which goenv 2>&1 > /dev/null
if [[ $? == 0 ]]; then
    echo initialize go env
    eval "$(goenv init -)"
fi

# make gcloud autocompletion work
if [[ -e $HOMEBREW_PREFIX/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/path.zsh.inc ]]; then
     source $HOMEBREW_PREFIX/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.zsh.inc
fi

if [[ -r $HOME/.smartcd_config ]]; then
    echo loading smartcd config
    source ~/.smartcd_config
fi

if [[ -n "$TILIX_ID" ]] || [[ -n "$VTE_VERSION" ]]; then
  source /etc/profile.d/vte.sh
fi

# Completion helpers and WSL tweaks
which eksctl 2>&1 > /dev/null
if [[ $? == 0 ]]; then
   echo loading eksctl completion
   eval $(eksctl completion zsh)
fi

which chef 2>&1 > /dev/null
if [[ $? == 0 ]]; then
   echo loading chef environment settings for zsh
   chef shell-init zsh > /tmp/chef_completion.zsh
   source /tmp/chef_completion.zsh
fi

fix_wsl_process

source <(kubectl completion zsh)
